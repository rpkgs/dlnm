<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Plot Predictions for a DLNM — plot.crosspred • dlnm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Plot Predictions for a DLNM — plot.crosspred"><meta property="og:description" content="High and low-level method functions for graphs (3d, contour, slices and overall) of predictions from distributed lag linear (DLMs) and non-linear (DLNMs) models."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dlnm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/dlmnTS.html">UNKNOWN TITLE</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/gasparrini/dlnm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Plot Predictions for a DLNM</h1>

    <div class="hidden name"><code>plot.crosspred.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>High and low-level method functions for graphs (3d, contour, slices and overall) of predictions from distributed lag linear (DLMs) and non-linear (DLNMs) models.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'crosspred'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ptype</span>, var<span class="op">=</span><span class="cn">NULL</span>, lag<span class="op">=</span><span class="cn">NULL</span>, ci<span class="op">=</span><span class="st">"area"</span>, <span class="va">ci.arg</span>,</span>
<span>  ci.level<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">ci.level</span>, cumul<span class="op">=</span><span class="cn">FALSE</span>, exp<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'crosspred'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ptype</span>, var<span class="op">=</span><span class="cn">NULL</span>, lag<span class="op">=</span><span class="cn">NULL</span>, ci<span class="op">=</span><span class="st">"n"</span>, <span class="va">ci.arg</span>,</span>
<span>  ci.level<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">ci.level</span>, cumul<span class="op">=</span><span class="cn">FALSE</span>, exp<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'crosspred'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ptype</span>, var<span class="op">=</span><span class="cn">NULL</span>, lag<span class="op">=</span><span class="cn">NULL</span>, ci<span class="op">=</span><span class="st">"n"</span>, <span class="va">ci.arg</span>,</span>
<span>  ci.level<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">ci.level</span>, cumul<span class="op">=</span><span class="cn">FALSE</span>, exp<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-x-">x <a class="anchor" aria-label="anchor" href="#arg-x-"></a></dt>
<dd><p>an object of class <code>"crosspred"</code>.</p></dd>

  <dt id="arg-ptype-">ptype <a class="anchor" aria-label="anchor" href="#arg-ptype-"></a></dt>
<dd><p>type of plot. Default to <code>"3d"</code> for lagged relationship, otherwise <code>"overall"</code>. Other options are <code>"slices"</code> and <code>"contour"</code>. See Details below.</p></dd>

   <dt id="arg-var-lag-">var, lag <a class="anchor" aria-label="anchor" href="#arg-var-lag-"></a></dt>
<dd><p>vectors (for <code>plot</code>) or numeric scalars (for <code>lines</code>-<code>points</code>) of predictor or lag values, respectively, at which specific associations must be plotted. Used only if <code>ptype="slices"</code>.</p></dd>

  <dt id="arg-ci-">ci <a class="anchor" aria-label="anchor" href="#arg-ci-"></a></dt>
<dd><p>type of confidence intervals representation: one of <code>"area"</code>, <code>"bars"</code>, <code>"lines"</code> or <code>"n"</code>. Default to <code>"area"</code> in high level functions, <code>"n"</code> for low-level functions.</p></dd>

  <dt id="arg-ci-arg-">ci.arg <a class="anchor" aria-label="anchor" href="#arg-ci-arg-"></a></dt>
<dd><p>list of arguments to be passed to low-level plotting functions to draw the confidence intervals. See Details.</p></dd>

  <dt id="arg-ci-level-">ci.level <a class="anchor" aria-label="anchor" href="#arg-ci-level-"></a></dt>
<dd><p>confidence level for the computation of confidence intervals.</p></dd>

  <dt id="arg-cumul-">cumul <a class="anchor" aria-label="anchor" href="#arg-cumul-"></a></dt>
<dd><p>logical. If <code>TRUE</code>, incremental cumulative associations along lags are plotted. Used only if <code>type="slices"</code>. See Details.</p></dd>

  <dt id="arg-exp-">exp <a class="anchor" aria-label="anchor" href="#arg-exp-"></a></dt>
<dd><p>logical. It forces the choice about the exponentiation. See Details.</p></dd>

  <dt id="arg--">... <a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>optional graphical arguments. See Details.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Different plots can be obtained by choosing the following values for the argument <code>ptype</code>:</p>
<p><b><code>"3d"</code></b>: a 3-D plot of predicted associations on the grid of predictor-lag values. Additional graphical arguments can be included, such as <code>theta</code>-<code>phi</code> (perspective), <code>border</code>-<code>shade</code> (surface), <code>xlab</code>-<code>ylab</code>-<code>zlab</code> (axis labelling) or <code>col</code>. See <code><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></code> for additional information.</p>
<p><b><code>"contour"</code></b>: a contour/level plot of predicted associations on the grid of predictor-lag values.  Additional graphical arguments can be included, such as <code>plot.title</code>-<code>plot.axes</code>-<code>key.title</code> for titles and axis and key labelling. Arguments <code>x</code>-<code>y</code>-<code>z</code> and <code>col</code>-<code>level</code> are automatically set and cannot be specified by the user. See <code><a href="https://rdrr.io/r/graphics/filled.contour.html" class="external-link">filled.contour</a></code> for additional information.</p>
<p><b><code>"overall"</code></b>: a plot of the overall cumulative exposure-response associations over the whole lag period. See <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot.default</a></code>, <code><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></code> and <code><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></code> for information on additional graphical arguments.</p>
<p><b><code>"slices"</code></b>: a (optionally multi-panel) plot of exposure-response association(s) for specific lag value(s), and/or lag-response association(s) for specific predictor value(s). Predictor and lag values are chosen by <code>var</code> and <code>lag</code>, respectively. See <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot.default</a></code>, <code><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></code> and <code><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></code> for information on additional graphical arguments.</p>
<p>The method function <code>plot</code> calls the high-level functions listed above for each <code>ptype</code>, while <code>lines</code>-<code>points</code> add lines or points for <code>ptype</code> equal to <code>"overall"</code> or <code>"slices"</code>. These methods allow a great flexibility in the choice of graphical parameters, specified through arguments of the original plotting functions. Some arguments, if not specified, are set to different default values than the original functions.</p>
<p>Confidence intervals are plotted for <code>ptype</code> equal to <code>"overall"</code> or <code>"slices"</code>. Their type is determined  by <code>ci</code>, with options <code>"area"</code> (default for <code>plot</code>), <code>"bars"</code>, <code>"lines"</code> or <code>"n"</code> (no confidence intervals, default for <code>points</code> and <code>lines</code>). Their appearance may be modified through <code>ci.arg</code>, a list of arguments passed to to low-level plotting functions: <code><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></code> for <code>"area"</code>, <code><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></code> for <code>"bars"</code> and <code><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></code> for <code>"lines"</code>. See the original functions for a complete list of the arguments. This option offers flexibility in the choice of confidence intervals display. As above, some unspecified arguments are set to different default values.</p>
<p>For <code>ptype="slices"</code>, up to 4 plots for each dimension of predictor and lags are allowed in <code>plot</code>, while for <code>lines</code>-<code>points</code> a single plot in one of the two dimension must be chosen. Incremental cumulative associations along lags are reported if <code>cumul=TRUE</code>: in this case, the same option must have been set to obtain the prediction saved in the <code>crosspred</code> object (see <code><a href="crosspred.html">crosspred</a></code>).</p>
<p>For a detailed illustration of the use of the functions, see:</p>
<p><code>vignette("dlnmOverview")</code></p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Gasparrini A. Distributed lag linear and non-linear models in R: the package dlnm. <em>Journal of Statistical Software</em>. 2011;<b>43</b>(8):1-20. [freely available <a href="http://www.ag-myresearch.com/2011_gasparrini_jss.html" class="external-link">here</a>].</p>
<p>Gasparrini A, Scheipl F, Armstrong B, Kenward MG. A penalized framework for distributed lag non-linear models. <em>Biometrics</em>. 2017;<b>73</b>(3):938-948. [freely available <a href="http://www.ag-myresearch.com/2017_gasparrini_biomet.html" class="external-link">here</a>]</p>
<p>Gasparrini A. Modeling exposure-lag-response associations with distributed lag non-linear models. <em>Statistics in Medicine</em>. 2014;<b>33</b>(5):881-899. [freely available <a href="http://www.ag-myresearch.com/2014_gasparrini_statmed.html" class="external-link">here</a>]</p>
<p>Gasparrini A., Armstrong, B.,Kenward M. G. Distributed lag non-linear models. <em>Statistics in Medicine</em>. 2010;<b>29</b>(21):2224-2234. [freely available <a href="http://www.ag-myresearch.com/2010_gasparrini_statmed.html" class="external-link">here</a>]</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Antonio Gasparrini &lt;<a href="mailto:antonio.gasparrini@lshtm.ac.uk">antonio.gasparrini@lshtm.ac.uk</a>&gt;</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>All the predictions are plotted using a reference value corresponding to the centering point for continuous functions or different values for the other functions (see the related help pages). This is determined by the argument <code>cen</code> in <code><a href="crosspred.html">crosspred</a></code>. Exponentiated predictions are returned by default if <code>x$model.link</code> is equal to <code>"log"</code> or <code>"logit"</code>.</p>
<p>These methods for class <code>"crosspred"</code> have replaced the old function <code>crossplot</code> since version 1.3.0.</p>
    </div>
    <div id="warnings">
    <h2>Warnings</h2>
    <p>The values in <code>var</code> and <code>lag</code> must match those specified in the object <code>crosspred</code> (see <code><a href="crosspred.html">crosspred</a></code>).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="crossbasis.html">crossbasis</a></code> to generate cross-basis matrices. <code><a href="crosspred.html">crosspred</a></code> to obtain predictions after model fitting.</p>
<p>See <code><a href="dlnm-package.html">dlnm-package</a></code> for an introduction to the package and for links to package vignettes providing more detailed information.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">### example of application in time series analysis - see vignette("dlnmTS")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create the crossbasis object for pm10</span></span></span>
<span class="r-in"><span><span class="va">cb3.pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="crossbasis.html">crossbasis</a></span><span class="op">(</span><span class="va">chicagoNMMAPS</span><span class="op">$</span><span class="va">pm10</span>, lag<span class="op">=</span><span class="fl">1</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"lin"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"strata"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># create the crossbasis object for temperature</span></span></span>
<span class="r-in"><span><span class="va">varknots</span> <span class="op">&lt;-</span> <span class="fu"><a href="equalknots.html">equalknots</a></span><span class="op">(</span><span class="va">chicagoNMMAPS</span><span class="op">$</span><span class="va">temp</span>,fun<span class="op">=</span><span class="st">"bs"</span>,df<span class="op">=</span><span class="fl">5</span>,degree<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lagknots</span> <span class="op">&lt;-</span> <span class="fu"><a href="logknots.html">logknots</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cb3.temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="crossbasis.html">crossbasis</a></span><span class="op">(</span><span class="va">chicagoNMMAPS</span><span class="op">$</span><span class="va">temp</span>, lag<span class="op">=</span><span class="fl">30</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"bs"</span>,</span></span>
<span class="r-in"><span>  knots<span class="op">=</span><span class="va">varknots</span><span class="op">)</span>, arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>knots<span class="op">=</span><span class="va">lagknots</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># summarize</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cb3.pm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CROSSBASIS FUNCTIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> observations: 5114 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range: -3.049835 to 356.1768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag period: 0 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> total df:  1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR VAR:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: lin </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR LAG:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: strata </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> df: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ref: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cb3.temp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CROSSBASIS FUNCTIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> observations: 5114 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range: -26.66667 to 33.33333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag period: 0 30 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> total df:  30 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR VAR:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: bs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> knots: -11.66667 3.333333 18.33333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> degree: 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary.knots: -26.66667 33.33333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR LAG:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: ns </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> knots: 1.105502 3.322105 9.983144 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary.knots: 0 30 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model and get the predictions for temperature</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">death</span> <span class="op">~</span>  <span class="va">cb3.pm</span> <span class="op">+</span> <span class="va">cb3.temp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">time</span>, <span class="fl">7</span><span class="op">*</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span> <span class="va">dow</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">chicagoNMMAPS</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pred3.temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">cb3.temp</span>, <span class="va">model3</span>, cen<span class="op">=</span><span class="fl">21</span>, by<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 3-D and contour plots</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred3.temp</span>, xlab<span class="op">=</span><span class="st">"Temperature"</span>, zlab<span class="op">=</span><span class="st">"RR"</span>, theta<span class="op">=</span><span class="fl">200</span>, phi<span class="op">=</span><span class="fl">40</span>, lphi<span class="op">=</span><span class="fl">30</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"3D graph of temperature effect"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred3.temp</span>, <span class="st">"contour"</span>, xlab<span class="op">=</span><span class="st">"Temperature"</span>, key.title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"RR"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  plot.title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Contour plot"</span>,xlab<span class="op">=</span><span class="st">"Temperature"</span>,ylab<span class="op">=</span><span class="st">"Lag"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># lag-response curves specific to different temperature values</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred3.temp</span>, <span class="st">"slices"</span>, var<span class="op">=</span><span class="op">-</span><span class="fl">20</span>, ci<span class="op">=</span><span class="st">"n"</span>, col<span class="op">=</span><span class="fl">1</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>,<span class="fl">1.25</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">1.5</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Lag-response curves for different temperatures, ref. 21C"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pred3.temp</span>, <span class="st">"slices"</span>, var<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">27</span>,<span class="fl">33</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, col<span class="op">=</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Temperature ="</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">0</span>,<span class="fl">27</span>,<span class="fl">33</span><span class="op">)</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, lwd<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># in one plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred3.temp</span>, <span class="st">"slices"</span>, var<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">0</span>,<span class="fl">27</span>,<span class="fl">33</span><span class="op">)</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">15</span>,<span class="fl">28</span><span class="op">)</span>, col<span class="op">=</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>  ci.arg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>density<span class="op">=</span><span class="fl">40</span>,col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of application beyond time series - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate the matrix of exposure histories from the 5-year periods</span></span></span>
<span class="r-in"><span><span class="va">Qnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">nested</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sub</span><span class="op">)</span> <span class="fu"><a href="exphist.html">exphist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="va">sub</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>, <span class="va">sub</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define the cross-basis</span></span></span>
<span class="r-in"><span><span class="va">cbnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="crossbasis.html">crossbasis</a></span><span class="op">(</span><span class="va">Qnest</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">40</span><span class="op">)</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"bs"</span>,degree<span class="op">=</span><span class="fl">2</span>,df<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"ns"</span>,knots<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">30</span><span class="op">)</span>,intercept<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cbnest</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CROSSBASIS FUNCTIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> observations: 600 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range: 0 to 1064 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag period: 3 40 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> total df:  9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR VAR:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: bs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> knots: 15 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> degree: 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary.knots: 0 1064 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR LAG:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: ns </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> knots: 10 30 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary.knots: 3 40 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model and predict</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/clogit.html" class="external-link">clogit</a></span><span class="op">(</span><span class="va">case</span><span class="op">~</span><span class="va">cbnest</span><span class="op">+</span><span class="fu"><a href="strata.html">strata</a></span><span class="op">(</span><span class="va">riskset</span><span class="op">)</span>, <span class="va">nested</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">cbnest</span>,<span class="va">mnest</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">*</span><span class="fl">5</span>, cen<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># bi-dimensional exposure-lag-response association</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest</span>, zlab<span class="op">=</span><span class="st">"OR"</span>, xlab<span class="op">=</span><span class="st">"Exposure"</span>, ylab<span class="op">=</span><span class="st">"Lag (years)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># lag-response curve for dose 60</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest</span>, var<span class="op">=</span><span class="fl">50</span>, ylab<span class="op">=</span><span class="st">"OR for exposure 50"</span>, xlab<span class="op">=</span><span class="st">"Lag (years)"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># exposure-response curve for lag 10</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest</span>, lag<span class="op">=</span><span class="fl">5</span>, ylab<span class="op">=</span><span class="st">"OR at lag 5"</span>, xlab<span class="op">=</span><span class="st">"Exposure"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>,<span class="fl">1.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of extended predictions - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compute exposure profiles and exposure history</span></span></span>
<span class="r-in"><span><span class="va">expnested</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">0</span>,<span class="fl">13</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="exphist.html">exphist</a></span><span class="op">(</span><span class="va">expnested</span>, time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">expnested</span><span class="op">)</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># predict association with a specific exposure history</span></span></span>
<span class="r-in"><span><span class="va">pnesthist</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">cbnest</span>, <span class="va">mnest</span>, cen<span class="op">=</span><span class="fl">0</span>, at<span class="op">=</span><span class="va">hist</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pnesthist</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">allRRfit</span>,<span class="va">allRRlow</span>,<span class="va">allRRhigh</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       20       20       20 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3.503928 1.240109 9.900351 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of user-defined functions - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define a log function</span></span></span>
<span class="r-in"><span><span class="va">mylog</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define the cross-basis</span></span></span>
<span class="r-in"><span><span class="va">cbnest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="crossbasis.html">crossbasis</a></span><span class="op">(</span><span class="va">Qnest</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">40</span><span class="op">)</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"mylog"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"ns"</span>,knots<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">30</span><span class="op">)</span>,intercept<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in get(fun, mode = "function", envir = envir):</span> object 'mylog' of mode 'function' was not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cbnest2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'cbnest2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model and predict</span></span></span>
<span class="r-in"><span><span class="va">mnest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/clogit.html" class="external-link">clogit</a></span><span class="op">(</span><span class="va">case</span><span class="op">~</span><span class="va">cbnest2</span><span class="op">+</span><span class="fu"><a href="strata.html">strata</a></span><span class="op">(</span><span class="va">riskset</span><span class="op">)</span>, <span class="va">nested</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(predvars, data, env):</span> object 'cbnest2' not found</span>
<span class="r-in"><span><span class="va">pnest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">cbnest2</span>, <span class="va">mnest2</span>, cen<span class="op">=</span><span class="fl">0</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'cbnest2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot and compare with previous fit</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest2</span>, zlab<span class="op">=</span><span class="st">"OR"</span>, xlab<span class="op">=</span><span class="st">"Exposure"</span>, ylab<span class="op">=</span><span class="st">"Lag (years)"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pnest2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest2</span>, var<span class="op">=</span><span class="fl">50</span>, ylab<span class="op">=</span><span class="st">"OR for exposure 50"</span>, xlab<span class="op">=</span><span class="st">"Lag (years)"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pnest2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pnest</span>, var<span class="op">=</span><span class="fl">50</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest2</span>, lag<span class="op">=</span><span class="fl">5</span>, ylab<span class="op">=</span><span class="st">"OR at lag 5"</span>, xlab<span class="op">=</span><span class="st">"Exposure"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>,<span class="fl">1.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pnest2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pnest</span>, lag<span class="op">=</span><span class="fl">5</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of general use for regression models - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># replicate example illustrated in help(ns)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">oneheight</span> <span class="op">&lt;-</span> <span class="fu"><a href="onebasis.html">onebasis</a></span><span class="op">(</span><span class="va">women</span><span class="op">$</span><span class="va">height</span>, <span class="st">"ns"</span>, df<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mwomen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">oneheight</span>, data<span class="op">=</span><span class="va">women</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pwomen</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">oneheight</span>, <span class="va">mwomen</span>, cen<span class="op">=</span><span class="fl">65</span>, at<span class="op">=</span><span class="fl">58</span><span class="op">:</span><span class="fl">72</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pwomen</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">allfit</span>, <span class="va">alllow</span>, <span class="va">allhigh</span><span class="op">)</span><span class="op">[</span><span class="st">"70"</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   allfit   alllow  allhigh </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18.92287 18.46545 19.38030 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pwomen</span>, ci<span class="op">=</span><span class="st">"l"</span>, ylab<span class="op">=</span><span class="st">"Weight (lb) difference"</span>, xlab<span class="op">=</span><span class="st">"Height (in)"</span>, col<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># replicate example illustrated in help(gam)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html" class="external-link">gamSim</a></span><span class="op">(</span><span class="fl">1</span>,n<span class="op">=</span><span class="fl">200</span>,dist<span class="op">=</span><span class="st">"poisson"</span>,scale<span class="op">=</span><span class="fl">.1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gu &amp; Wahba 4 term additive model</span>
<span class="r-in"><span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x0</span>,bs<span class="op">=</span><span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x1</span>,bs<span class="op">=</span><span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x2</span>,bs<span class="op">=</span><span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x3</span>,bs<span class="op">=</span><span class="st">"cr"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="va">poisson</span>, data<span class="op">=</span><span class="va">dat</span>, method<span class="op">=</span><span class="st">"REML"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b2</span>, select<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">pgam</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="st">"x2"</span>, <span class="va">b2</span>, cen<span class="op">=</span><span class="fl">0</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">100</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pgam</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">allRRfit</span>, <span class="va">allRRlow</span>, <span class="va">allRRhigh</span><span class="op">)</span><span class="op">[</span><span class="st">"0.7"</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  allRRfit  allRRlow allRRhigh </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.7786604 0.5347209 1.1338852 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pgam</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"RR"</span>, xlab<span class="op">=</span><span class="st">"x2"</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="plot.crosspred-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of penalized models - see vignette("dlnmPenalized")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to be added soon</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Antonio Gasparrini, Ben Armstrong.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

