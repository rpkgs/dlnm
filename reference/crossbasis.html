<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Generate a Cross-Basis Matrix for a DLNM — crossbasis • dlnm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a Cross-Basis Matrix for a DLNM — crossbasis"><meta property="og:description" content="The function generates the basis matrices for the two dimensions of predictor and lags, given the functions selected to model the relationship in each space. Then, these one-dimensions basis matrices are combined in order to create the related cross-basis matrix, which can be included in a model formula to fit distributed lag linear (DLMs) and non-linear models (DLNMs)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dlnm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/dlmnTS.html">UNKNOWN TITLE</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/gasparrini/dlnm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate a Cross-Basis Matrix for a DLNM</h1>

    <div class="hidden name"><code>crossbasis.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function generates the basis matrices for the two dimensions of predictor and lags, given the functions selected to model the relationship in each space. Then, these one-dimensions basis matrices are combined in order to create the related cross-basis matrix, which can be included in a model formula to fit distributed lag linear (DLMs) and non-linear models (DLNMs).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">crossbasis</span><span class="op">(</span><span class="va">x</span>, <span class="va">lag</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, group<span class="op">=</span><span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'crossbasis'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-x-">x <a class="anchor" aria-label="anchor" href="#arg-x-"></a></dt>
<dd><p>either a numeric vector representing a complete series of ordered observations (for time series data), or a matrix of exposure histories over the same lag period for each observation. See Details below.</p></dd>

  <dt id="arg-lag-">lag <a class="anchor" aria-label="anchor" href="#arg-lag-"></a></dt>
<dd><p>either an integer scalar or vector of length 2, defining the the maximum lag or the lag range, respectively.</p></dd>

  <dt id="arg-argvar-arglag-">argvar, arglag <a class="anchor" aria-label="anchor" href="#arg-argvar-arglag-"></a></dt>
<dd><p>lists of arguments to be passed to the function <code><a href="onebasis.html">onebasis</a></code> for generating the two basis matrices for predictor and lags, respectively. See Details below.</p></dd>

 <dt id="arg-group-">group <a class="anchor" aria-label="anchor" href="#arg-group-"></a></dt>
<dd><p>a factor or a list of factors defining groups of observations. Only for time series data.</p></dd>

 <dt id="arg-object-">object <a class="anchor" aria-label="anchor" href="#arg-object-"></a></dt>
<dd><p>a object of class <code>"crossbasis"</code>.</p></dd>

  <dt id="arg--">... <a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments. See Details below.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The argument <code>x</code> defines the type of data. If a \(n\)-dimensional vector, the data are interpreted as a time series of equally-spaced and complete observations. If a \(n \times (L-\ell_0+1)\) matrix, the data are interpreted as a set of complete exposure histories at equally-spaced lags over the same lag period from \(\ell_0\) to \(L\) for each observation. The latter is general and can be used for applying DLMs and DLNMs beyond time series data. Lags are usually positive integers: if not provided, by default the minimum lag \(L0\) is set to 0, and the maximum lag \(L\) is set to 0 if <code>x</code> is a vector or to <code>ncol(x)-1</code> otherwise. Negative lags are rarely needed but allowed.</p>
<p>The lists in <code>argvar</code> and <code>arglag</code> are passed to <code><a href="onebasis.html">onebasis</a></code>, which calls existing or user-defined functions to build the related basis matrices. The two lists should contain the argument <code>fun</code> defining the chosen function, and a set of additional arguments of the function. The <code>argvar</code> list is applied to <code>x</code>, in order to generate the matrix for the space of the predictor. The <code>arglag</code> list is applied to a new vector given by the sequence obtained by <code>lag</code>, in order to generate the matrix for the space of lags. By default, the basis functions for lags are defined with an intercept (if not otherwise stated). Some arguments can be automatically re-set by <code><a href="onebasis.html">onebasis</a></code>. Then, the two set of basis matrices are combined in order to create the related cross-basis matrix.</p>
<p>Common choices for <code>fun</code> are represented by <code><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></code> and <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></code> from package <span class="pkg">splines</span> or by the internal functions of the package <span class="pkg">dlnm</span>, namely <code><a href="poly.html">poly</a></code>, <code><a href="strata.html">strata</a></code>, <code><a href="thr.html">thr</a></code>, <code><a href="integer.html">integer</a></code> and <code><a href="lin.html">lin</a></code>. In particular, DLMs can be considered a special case of DLNMs with a linear function in <code>argvar</code>. Functions <code><a href="ps.html">ps</a></code> and <code><a href="cr.html">cr</a></code> are used to specify penalized models with an external method (see <code><a href="cbPen.html">cbPen</a></code>). See <code><a href="onebasis.html">help(onebasis)</a></code> and the help pages of these functions for information on the additional arguments to be specified. Also, other existing or user-defined functions can be applied.</p>
<p>The argument <code>group</code>, only used for time series data, defines groups of observations representing independent series. Each series must be consecutive, complete and ordered.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>A matrix object of class <code>"crossbasis"</code> which can be included in a model formula in order to fit a DLM or DLNM. It contains the attributes <code>df</code> (vector of length 2 with the df for each dimension), <code>range</code> (range of the original vector of observations), <code>lag</code> (lag range), <code>argvar</code> and <code>arglag</code> (lists of arguments defining the basis functions in each space, which can be modified if compared to lists used in the call). The method <code>summary.crossbasis</code> returns a summary of the cross-basis matrix and the related attributes, and can be used to check the options for the basis functions chosen for the two dimensions.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Gasparrini A. Distributed lag linear and non-linear models in R: the package dlnm. <em>Journal of Statistical Software</em>. 2011;<b>43</b>(8):1-20. [freely available <a href="http://www.ag-myresearch.com/2011_gasparrini_jss.html" class="external-link">here</a>].</p>
<p>Gasparrini A, Scheipl F, Armstrong B, Kenward MG. A penalized framework for distributed lag non-linear models. <em>Biometrics</em>. 2017;<b>73</b>(3):938-948. [freely available <a href="http://www.ag-myresearch.com/2017_gasparrini_biomet.html" class="external-link">here</a>]</p>
<p>Gasparrini A. Modeling exposure-lag-response associations with distributed lag non-linear models. <em>Statistics in Medicine</em>. 2014;<b>33</b>(5):881-899. [freely available <a href="http://www.ag-myresearch.com/2014_gasparrini_statmed.html" class="external-link">here</a>]</p>
<p>Gasparrini A., Armstrong, B.,Kenward M. G. Distributed lag non-linear models. <em>Statistics in Medicine</em>. 2010;<b>29</b>(21):2224-2234. [freely available <a href="http://www.ag-myresearch.com/2010_gasparrini_statmed.html" class="external-link">here</a>]</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Antonio Gasparrini &lt;<a href="mailto:antonio.gasparrini@lshtm.ac.uk">antonio.gasparrini@lshtm.ac.uk</a>&gt;</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Missing values in <code>x</code> are allowed, but this causes the observation (for non-time series data with <code>x</code> as a matrix) or the following observations corresponding to the lag period (for time series data with <code>x</code> as a vector series) to be set to <code>NA</code>. Although correct, this could generate computational problems in the presence of a high number of missing observations.</p>
<p>The name of the crossbasis object will be used by <code><a href="crosspred.html">crosspred</a></code> in order to extract the related estimated parameters. If more than one variable is transformed through cross-basis functions in the same model, different names must be specified.</p>
<p>Before version 2.2.0 of <span class="pkg">dlnm</span>, the <code>argvar</code> list could include a <code>cen</code> argument to be passed internally to <code><a href="onebasis.html">onebasis</a></code> for centering the basis. This step is now moved to the prediction stage, with a <code>cen</code> argument in <code><a href="crosspred.html">crosspred</a></code> or <code><a href="crossreduce.html">crossreduce</a></code> (see the related help pages). For backward compatibility, the use of <code>cen</code> in <code>crossbasis</code> is still allowed (with a warning), but may be discontinued in future versions.</p>
    </div>
    <div id="warnings">
    <h2>Warnings</h2>
    <p>In previous versions of the package the function adopted a different usage. In particular, the <code>argvar</code> list should not include a <code>cen</code> argument any more (see Note in this help page or <code><a href="onebasis.html">onebasis</a></code>). Users are strongly suggested to comply with the current usage, as backward compatibility may be discontinued in future versions of the package.</p>
<p>Meaningless combinations of arguments in <code>argvar</code> and <code>arglag</code> passed to <code><a href="onebasis.html">onebasis</a></code> could lead to collinear variables, with identifiability problems in the model and the exclusion of some of them.</p>
<p>It is strongly recommended to avoid the inclusion of an intercept in the basis for <code>x</code> (<code>intercept</code> in <code>argvar</code> should be <code>FALSE</code>, as default), otherwise a rank-deficient cross-basis matrix will be specified, causing some of the cross-variables to be excluded in the regression model. Conversely, an intercept is included by default in the basis for the space of lags.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="onebasis.html">onebasis</a></code> to generate one-dimensional basis matrices. The <code><a href="smooth.construct.cb.smooth.spec.html">cb smooth constructor</a></code> for cross-basis penalized spline smooths. <code><a href="crosspred.html">crosspred</a></code> to obtain predictions after model fitting. The method function <code><a href="plot.crosspred.html">plot</a></code> to plot several type of graphs.</p>
<p>See <code><a href="dlnm-package.html">dlnm-package</a></code> for an introduction to the package and for links to package vignettes providing more detailed information.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">### example of application in time series analysis - see vignette("dlnmTS")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create the crossbasis objects and summarize their contents</span></span></span>
<span class="r-in"><span><span class="va">cb1.pm</span> <span class="op">&lt;-</span> <span class="fu">crossbasis</span><span class="op">(</span><span class="va">chicagoNMMAPS</span><span class="op">$</span><span class="va">pm10</span>, lag<span class="op">=</span><span class="fl">15</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"lin"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"poly"</span>,degree<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cb1.temp</span> <span class="op">&lt;-</span> <span class="fu">crossbasis</span><span class="op">(</span><span class="va">chicagoNMMAPS</span><span class="op">$</span><span class="va">temp</span>, lag<span class="op">=</span><span class="fl">3</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>df<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"strata"</span>,breaks<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cb1.pm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CROSSBASIS FUNCTIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> observations: 5114 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range: -3.049835 to 356.1768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag period: 0 15 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> total df:  5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR VAR:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: lin </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR LAG:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: poly </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> degree: 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> scale: 15 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cb1.temp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CROSSBASIS FUNCTIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> observations: 5114 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range: -26.66667 to 33.33333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag period: 0 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> total df:  10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR VAR:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: ns </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> knots: 0.2777778 6.666667 14.44444 20.94444 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary.knots: -26.66667 33.33333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR LAG:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: strata </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> df: 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> breaks: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ref: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model and get the predictions for pm10</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">death</span> <span class="op">~</span> <span class="va">cb1.pm</span> <span class="op">+</span> <span class="va">cb1.temp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">time</span>, <span class="fl">7</span><span class="op">*</span><span class="fl">14</span><span class="op">)</span> <span class="op">+</span> <span class="va">dow</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">chicagoNMMAPS</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pred1.pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">cb1.pm</span>, <span class="va">model1</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span>, bylag<span class="op">=</span><span class="fl">0.2</span>, cumul<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the lag-response curves for specific and incremental cumulative effects</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred1.pm</span>, <span class="st">"slices"</span>, var<span class="op">=</span><span class="fl">10</span>, col<span class="op">=</span><span class="fl">3</span>, ylab<span class="op">=</span><span class="st">"RR"</span>, ci.arg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>density<span class="op">=</span><span class="fl">15</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Lag-response curve for a 10-unit increase in PM10"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crossbasis-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred1.pm</span>, <span class="st">"slices"</span>, var<span class="op">=</span><span class="fl">10</span>, col<span class="op">=</span><span class="fl">2</span>, cumul<span class="op">=</span><span class="cn">TRUE</span>, ylab<span class="op">=</span><span class="st">"Cumulative RR"</span>,</span></span>
<span class="r-in"><span>  main<span class="op">=</span><span class="st">"Lag-response curve of incremental cumulative effects"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crossbasis-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of application beyond time series - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate the matrix of exposure histories from the 5-year periods</span></span></span>
<span class="r-in"><span><span class="va">Qnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">nested</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sub</span><span class="op">)</span> <span class="fu"><a href="exphist.html">exphist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="va">sub</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  each<span class="op">=</span><span class="fl">5</span><span class="op">)</span>, <span class="va">sub</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define the cross-basis</span></span></span>
<span class="r-in"><span><span class="va">cbnest</span> <span class="op">&lt;-</span> <span class="fu">crossbasis</span><span class="op">(</span><span class="va">Qnest</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">40</span><span class="op">)</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"bs"</span>,degree<span class="op">=</span><span class="fl">2</span>,df<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"ns"</span>,knots<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">30</span><span class="op">)</span>,intercept<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cbnest</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CROSSBASIS FUNCTIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> observations: 600 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range: 0 to 1064 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag period: 3 40 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> total df:  9 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR VAR:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: bs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> knots: 15 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> degree: 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary.knots: 0 1064 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR LAG:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: ns </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> knots: 10 30 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Boundary.knots: 3 40 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model and predict</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/clogit.html" class="external-link">clogit</a></span><span class="op">(</span><span class="va">case</span><span class="op">~</span><span class="va">cbnest</span><span class="op">+</span><span class="fu"><a href="strata.html">strata</a></span><span class="op">(</span><span class="va">riskset</span><span class="op">)</span>, <span class="va">nested</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">cbnest</span>,<span class="va">mnest</span>, cen<span class="op">=</span><span class="fl">0</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># bi-dimensional exposure-lag-response association</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest</span>, zlab<span class="op">=</span><span class="st">"OR"</span>, xlab<span class="op">=</span><span class="st">"Exposure"</span>, ylab<span class="op">=</span><span class="st">"Lag (years)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crossbasis-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># lag-response curve for dose 60</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest</span>, var<span class="op">=</span><span class="fl">50</span>, ylab<span class="op">=</span><span class="st">"OR for exposure 50"</span>, xlab<span class="op">=</span><span class="st">"Lag (years)"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crossbasis-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># exposure-response curve for lag 10</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest</span>, lag<span class="op">=</span><span class="fl">5</span>, ylab<span class="op">=</span><span class="st">"OR at lag 5"</span>, xlab<span class="op">=</span><span class="st">"Exposure"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>,<span class="fl">1.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of extended predictions - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compute exposure profiles and exposure history</span></span></span>
<span class="r-in"><span><span class="va">expnested</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">0</span>,<span class="fl">13</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="exphist.html">exphist</a></span><span class="op">(</span><span class="va">expnested</span>, time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">expnested</span><span class="op">)</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># predict association with a specific exposure history</span></span></span>
<span class="r-in"><span><span class="va">pnesthist</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">cbnest</span>, <span class="va">mnest</span>, cen<span class="op">=</span><span class="fl">0</span>, at<span class="op">=</span><span class="va">hist</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pnesthist</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">allRRfit</span>,<span class="va">allRRlow</span>,<span class="va">allRRhigh</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       20       20       20 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3.503928 1.240109 9.900351 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of user-defined functions - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define a log function</span></span></span>
<span class="r-in"><span><span class="va">mylog</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define the cross-basis</span></span></span>
<span class="r-in"><span><span class="va">cbnest2</span> <span class="op">&lt;-</span> <span class="fu">crossbasis</span><span class="op">(</span><span class="va">Qnest</span>, lag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">40</span><span class="op">)</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"mylog"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"ns"</span>,knots<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">30</span><span class="op">)</span>,intercept<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in get(fun, mode = "function", envir = envir):</span> object 'mylog' of mode 'function' was not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cbnest2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'cbnest2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model and predict</span></span></span>
<span class="r-in"><span><span class="va">mnest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/clogit.html" class="external-link">clogit</a></span><span class="op">(</span><span class="va">case</span><span class="op">~</span><span class="va">cbnest2</span><span class="op">+</span><span class="fu"><a href="strata.html">strata</a></span><span class="op">(</span><span class="va">riskset</span><span class="op">)</span>, <span class="va">nested</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(predvars, data, env):</span> object 'cbnest2' not found</span>
<span class="r-in"><span><span class="va">pnest2</span> <span class="op">&lt;-</span> <span class="fu"><a href="crosspred.html">crosspred</a></span><span class="op">(</span><span class="va">cbnest2</span>, <span class="va">mnest2</span>, cen<span class="op">=</span><span class="fl">0</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'cbnest2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot and compare with previous fit</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest2</span>, zlab<span class="op">=</span><span class="st">"OR"</span>, xlab<span class="op">=</span><span class="st">"Exposure"</span>, ylab<span class="op">=</span><span class="st">"Lag (years)"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pnest2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest2</span>, var<span class="op">=</span><span class="fl">50</span>, ylab<span class="op">=</span><span class="st">"OR for exposure 50"</span>, xlab<span class="op">=</span><span class="st">"Lag (years)"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pnest2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pnest</span>, var<span class="op">=</span><span class="fl">50</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pnest2</span>, lag<span class="op">=</span><span class="fl">5</span>, ylab<span class="op">=</span><span class="st">"OR at lag 5"</span>, xlab<span class="op">=</span><span class="st">"Exposure"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.95</span>,<span class="fl">1.15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pnest2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pnest</span>, lag<span class="op">=</span><span class="fl">5</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crossbasis-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of penalized models - see vignette("dlnmPenalized")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to be added soon</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Antonio Gasparrini, Ben Armstrong.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

