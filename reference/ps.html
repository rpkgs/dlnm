<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Generate a Basis Matrix for P-Splines — ps • dlnm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a Basis Matrix for P-Splines — ps"><meta property="og:description" content="Generate the basis matrix for P-splines, namely a B-spline basis with difference penalties."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dlnm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/basics.html">basics</a>
    </li>
    <li>
      <a href="../articles/crosspred.html">crosspred</a>
    </li>
    <li>
      <a href="../articles/dlmnTS.html">dlmnTS</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/gasparrini/dlnm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate a Basis Matrix for P-Splines</h1>

    <div class="hidden name"><code>ps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Generate the basis matrix for P-splines, namely a B-spline basis with difference penalties.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ps</span><span class="op">(</span><span class="va">x</span>, df<span class="op">=</span><span class="fl">10</span>, knots<span class="op">=</span><span class="cn">NULL</span>, degree<span class="op">=</span><span class="fl">3</span>, intercept<span class="op">=</span><span class="cn">FALSE</span>, fx<span class="op">=</span> <span class="cn">FALSE</span>, S<span class="op">=</span><span class="cn">NULL</span>, diff<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-x-">x <a class="anchor" aria-label="anchor" href="#arg-x-"></a></dt>
<dd><p>the predictor variable. Missing values are allowed.</p></dd>

  <dt id="arg-df-">df <a class="anchor" aria-label="anchor" href="#arg-df-"></a></dt>
<dd><p>degrees of freedom, basically the dimension of the basis matrix. If supplied in the absence of <code>knots</code>, it automatically selects <code>df+degree+2-intercept</code> equally-spaced knots (within and beyond the range of <code>x</code>). The minimum <code>df</code> allowed is <code>degree+1-intercept</code>.</p></dd>

  <dt id="arg-knots-">knots <a class="anchor" aria-label="anchor" href="#arg-knots-"></a></dt>
<dd><p>breakpoints that define the spline. These are generally automatically selected, and not defined by the user. See Details below.</p></dd>

  <dt id="arg-degree-">degree <a class="anchor" aria-label="anchor" href="#arg-degree-"></a></dt>
<dd><p>degree of the piecewise polynomial. Default is 3 for cubic splines.</p></dd>

  <dt id="arg-intercept-">intercept <a class="anchor" aria-label="anchor" href="#arg-intercept-"></a></dt>
<dd><p>logical. If <code>TRUE</code>, an intercept is included in the basis matrix. See Details below.</p></dd>

  <dt id="arg-fx-">fx <a class="anchor" aria-label="anchor" href="#arg-fx-"></a></dt>
<dd><p>logical. If <code>TRUE</code>, it removes the penalization. See Details below.</p></dd>

  <dt id="arg-s-">S <a class="anchor" aria-label="anchor" href="#arg-s-"></a></dt>
<dd><p>penalty matrix, usually internally defined if <code>NULL</code> (default).</p></dd>

  <dt id="arg-diff-">diff <a class="anchor" aria-label="anchor" href="#arg-diff-"></a></dt>
<dd><p>order difference of the penalty.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>The function has a usage similar to <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></code> and <code><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></code> in the <span class="pkg">splines</span> package. It produces B-spline transformations through a call to <code><a href="https://rdrr.io/r/splines/splineDesign.html" class="external-link">splineDesign</a></code>, plus a difference matrix to define penalties. The same results are returned by the related <code><a href="https://rdrr.io/pkg/mgcv/man/smooth.construct.ps.smooth.spec.html" class="external-link">smooth.construct.ps.smooth.spec</a></code> in the package <span class="pkg">mgcv</span>.</p>
<p>The argument <code>knots</code> defines a vector of knots or (if of length 2) the lower and upper limits between which the splines can be evaluated. However, knots should be usually left automatically selected, and in particular these P-splines only have sense with equally-spaced knots, due to the nature of the penalization. It is important to highlight that, differently from <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></code> where <em>internal</em> and <em>boundary</em> knots are defined, this function adopts a standard B-spline parameterization, including by default <code>2*(degree+1)</code> knots beyond the range of the variable.</p>
<p>The penalization is defined on the difference of adjacent coefficients during fitting procedure through a penalty matrix <code>S</code>. The argument <code>diff</code> selects the order difference (with the default 2 determining a second order difference, and 0 producing a ridge penalty), while setting <code>fx=TRUE</code> removes the penalization.</p>
<p>Similarly to <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></code> and <code><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></code>, setting <code>intercept=FALSE</code> (default) determines the exclusion of the first transformed variables, and the corresponding first row and column in <code>S</code>, thus avoiding identifiability issues during the model fitting. Note how the procedure of imposing identifiability constraints is different from that adopted by <code><a href="https://rdrr.io/pkg/mgcv/man/smoothCon.html" class="external-link">smoothCon</a></code> in the package <span class="pkg">mgcv</span>, where a more complex reparameterization is produced.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>A matrix object of class <code>"ps"</code>. It contains the attributes <code>df</code>, <code>knots</code>, <code>degree</code>, <code>intercept</code>, <code>fx</code>, <code>S</code>, and <code>diff</code>, with values that can be different than the arguments provided due to internal reset.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Gasparrini A, Scheipl F, Armstrong B, Kenward MG. A penalized framework for distributed lag non-linear models. <em>Biometrics</em>. 2017;<b>73</b>(3):938-948. [freely available <a href="http://www.ag-myresearch.com/2017_gasparrini_biomet.html" class="external-link">here</a>]</p>
<p>Eilers P. H. C. and Marx B. D. Flexible smoothing with B-splines and penalties. <em>Statistical Science</em>. 1996;<b>11</b>(2):89-121.</p>
<p>Wood S. N. Generalized Additive Models: An Introduction with R. Chapman and Hall/CRC Press, 2006.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Antonio Gasparrini &lt;<a href="mailto:antonio.gasparrini@lshtm.ac.uk">antonio.gasparrini@lshtm.ac.uk</a>&gt;, adapting code available from functions included in the package <span class="pkg">mgcv</span> by Simon N. Wood.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>The function is primarily added here to specify penalized DLMs and DLNMs using the so-called <em>external</em> method, <em>i.e.</em> by including the penalty matrix in the argument <code>paraPen</code> of the <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code> regression function in <span class="pkg">mgcv</span>  (see <code><a href="cbPen.html">cbPen</a></code>). However, this approach can be also used to fit standard uni-dimensional P-spline models as an alternative to the use of specific <code><a href="https://rdrr.io/pkg/mgcv/man/smooth.construct.ps.smooth.spec.html" class="external-link">smooth.construct.ps.smooth.spec</a></code>, as it takes advantage of the use of prediction and plotting functions in <span class="pkg">dlnm</span>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="cr.html">cr</a></code> for penalized cubic regression splines. <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></code> and <code><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></code> for B-splines and natural cubic splines, respectively. <code><a href="cbPen.html">cbPen</a></code> for defining tensor-type bi-dimensional penalties in DLNMs. The related <code><a href="https://rdrr.io/pkg/mgcv/man/smooth.construct.ps.smooth.spec.html" class="external-link">smooth.construct.ps.smooth.spec</a></code> for P-spline smooths in <span class="pkg">mgcv</span>. The <code><a href="smooth.construct.cb.smooth.spec.html">cb smooth constructor</a></code> for cross-basis penalized spline smooths.</p>
<p>See <code><a href="dlnm-package.html">dlnm-package</a></code> for an introduction to the package and for links to package vignettes providing more detailed information.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># to be added soon</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Antonio Gasparrini, Ben Armstrong.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

