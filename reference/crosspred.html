<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Generate Predictions for a DLNM — crosspred • dlnm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Predictions for a DLNM — crosspred"><meta property="og:description" content="The function generates predictions from distributed lag linear (DLMs) and non-linear models (DLNMs). These are interpreted as estimated associations defined on a grid of values of the original predictor and lags, computed versus a reference predictor value. This function can be used more generally to generate predictions and facilitate interpretation for uni-dimensional unlagged models."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dlnm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/basics.html">basics</a>
    </li>
    <li>
      <a href="../articles/dlmnTS.html">dlmnTS</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/gasparrini/dlnm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate Predictions for a DLNM</h1>

    <div class="hidden name"><code>crosspred.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The function generates predictions from distributed lag linear (DLMs) and non-linear models (DLNMs). These are interpreted as estimated associations defined on a grid of values of the original predictor and lags, computed versus a reference predictor value. This function can be used more generally to generate predictions and facilitate interpretation for uni-dimensional unlagged models.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">crosspred</span><span class="op">(</span><span class="va">basis</span>, model<span class="op">=</span><span class="cn">NULL</span>, coef<span class="op">=</span><span class="cn">NULL</span>, vcov<span class="op">=</span><span class="cn">NULL</span>, model.link<span class="op">=</span><span class="cn">NULL</span>, at<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>  from<span class="op">=</span><span class="cn">NULL</span>, to<span class="op">=</span><span class="cn">NULL</span>, by<span class="op">=</span><span class="cn">NULL</span>, <span class="va">lag</span>, bylag<span class="op">=</span><span class="fl">1</span>, cen<span class="op">=</span><span class="cn">NULL</span>, ci.level<span class="op">=</span><span class="fl">0.95</span>,</span>
<span>  cumul<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'crosspred'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-basis-">basis <a class="anchor" aria-label="anchor" href="#arg-basis-"></a></dt>
<dd><p>usually an object of class <code>"crossbasis"</code> or <code>"onebasis"</code>. Alternatively a character string for penalized models. See Details below.</p></dd>

  <dt id="arg-model-">model <a class="anchor" aria-label="anchor" href="#arg-model-"></a></dt>
<dd><p>a model object for which the prediction is desired. See Details below.</p></dd>

  <dt id="arg-coef-vcov-model-link-">coef, vcov, model.link <a class="anchor" aria-label="anchor" href="#arg-coef-vcov-model-link-"></a></dt>
<dd><p>user-provided coefficients, (co)variance matrix and model link for the prediction. See Details below.</p></dd>

  <dt id="arg-at-">at <a class="anchor" aria-label="anchor" href="#arg-at-"></a></dt>
<dd><p>either a numeric vector representing the values of a constant exposure throughout the lag period defined by <code>lag</code>, or a matrix of exposure histories over the same lag period used for estimation.</p></dd>

  <dt id="arg-from-to">from, to<a class="anchor" aria-label="anchor" href="#arg-from-to"></a></dt>
<dd><p>range of predictor values used for prediction.</p></dd>

  <dt id="arg-lag-">lag <a class="anchor" aria-label="anchor" href="#arg-lag-"></a></dt>
<dd><p>either an integer scalar or vector of length 2, defining the lag range used for prediction. Defalut to values used for estimation.</p></dd>

  <dt id="arg-by-bylag">by, bylag<a class="anchor" aria-label="anchor" href="#arg-by-bylag"></a></dt>
<dd><p>increment of the sequences of predictor and lag values used for prediction.</p></dd>

  <dt id="arg-cen-">cen <a class="anchor" aria-label="anchor" href="#arg-cen-"></a></dt>
<dd><p>logical or a numeric scalar. It specifies the centering value, then used as a reference for predictions. See Details below.</p></dd>

  <dt id="arg-ci-level-">ci.level <a class="anchor" aria-label="anchor" href="#arg-ci-level-"></a></dt>
<dd><p>confidence level for the computation of confidence intervals.</p></dd>

  <dt id="arg-cumul-">cumul <a class="anchor" aria-label="anchor" href="#arg-cumul-"></a></dt>
<dd><p>logical. If <code>TRUE</code>, incremental cumulative associations along (integer) lags are also predicted. See Details.</p></dd>

  <dt id="arg-object-">object <a class="anchor" aria-label="anchor" href="#arg-object-"></a></dt>
<dd><p>an object of class <code>"crosspred"</code>.</p></dd>

  <dt id="arg--">... <a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments to be passed to <code>summary</code>.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>model</code> is the model object including <code>basis</code> in its formula. <code>basis</code> is usually an object representing the cross-basis or basis matrix included in <code>model</code>, preserving its attributes and class. Alternatively, for penalized models fitted with <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>, <code>basis</code> can be a character string identifying the first argument of <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></code> in the model formula (see the <code><a href="smooth.construct.cb.smooth.spec.html">cb smooth constructor</a></code>). Examples are provided below in the related section.</p>
<p>The function computes predictions for specific combinations of predictor and lag values, and the net overall predictions accounting for the whole lag period. By default, predictor values are set internally as approximately 50 equally-spaced points within the range, or alternatively directly defined through <code>at</code> or <code>from</code>/<code>to</code>/<code>by</code>. Lag values are are set by default at all the integer values within the lag period, or determined by <code>lag</code> and <code>bylag</code>.</p>
<p>The values in <code>at</code> can be provided as a vector, and in this case they are replicated for each lag. As an alternative usage, <code>at</code> can be provided as a matrix of complete exposure histories over the same lag period used for estimation, in order to compute the association with a specific exposure pattern (see also <code><a href="exphist.html">exphist</a></code>).</p>
<p>Predictions are computed versus a reference value, with default values dependent on the function used in <code>basis</code>, or manually set through <code>cen</code>. Briefly, sensible default values are automatically defined for <code><a href="strata.html">strata</a></code>, <code><a href="thr.html">thr</a></code> and <code><a href="integer.html">integer</a></code> (corresponding to the reference region), and for <code><a href="lin.html">lin</a></code> (corresponding to 0). For other choices, such as <code><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></code>, <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></code>, <code><a href="poly.html">poly</a></code> or other existing or user-defined functions, the centering value is set by default to the mid-range. The inclusion of the intercept in <code>basis</code> term nullifies the centering.</p>
<p>Exponentiated predictions are included if <code>model.link</code> is equal to <code>"log"</code> or <code>"logit"</code>. Confidence intervals computed using a normal approximation and a confidence level of <code>ci.level</code>. <code>model.link</code> is automatically selected from <code>model</code> for some classes when set to <code>NULL</code> (default), but needs to be provided for different classes. Matrices with incremental cumulative predicted associations along integer lags at each exposure values used for prediction are included if <code>cumul=TRUE</code>.</p>
<p>The function automatically works with model objects from regression function <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></code> and <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code> (package <span class="pkg">mgcv</span>), <code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></code> and <code><a href="https://rdrr.io/pkg/survival/man/clogit.html" class="external-link">clogit</a></code> (package <span class="pkg">survival</span>), <code><a href="https://rdrr.io/pkg/nlme/man/lme.html" class="external-link">lme</a></code> and <code><a href="https://rdrr.io/pkg/nlme/man/nlme.html" class="external-link">nlme</a></code> (package <span class="pkg">nlme</span>), <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></code> and <code><a href="https://rdrr.io/pkg/lme4/man/glmer.html" class="external-link">glmer</a></code> and <code><a href="https://rdrr.io/pkg/lme4/man/nlmer.html" class="external-link">nlmer</a></code> (package <span class="pkg">lme4</span>), <code><a href="https://rdrr.io/pkg/gee/man/gee.html" class="external-link">gee</a></code> (package <span class="pkg">gee</span>), <code><a href="https://rdrr.io/pkg/geepack/man/geeglm.html" class="external-link">geeglm</a></code> (package <span class="pkg">geepack</span>). The function also works with any regression function for which <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></code> and <code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></code> methods are available. Otherwise, the user needs to input the coefficients and associated (co)variance matrix related to the parameters of the crossbasis as arguments <code>coef</code> and <code>vcov</code>, and information on the link function in <code>model.link</code>. In this case, dimensions and order must match the variables included in <code>basis</code>.</p>
<p>The function can be used to compute predictions for models with simple uni-dimensional basis functions not including lag, derived either with <code><a href="onebasis.html">onebasis</a></code> or with smooth penalized functions in <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code>. In this case, only unlagged predicted associations are returned.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>A list object of class <code>"crosspred"</code> with the following (optional) components:</p>
<dl><dt>predvar </dt>
<dd><p>vector or matrix of values used for prediction, depending on the format of the argument <code>at</code> (see Details above).</p></dd>

  <dt>cen </dt>
<dd><p>(optional) numeric scalar defining the centering value.</p></dd>

  <dt>lag </dt>
<dd><p>integer vector defining the lag range used for prediction.</p></dd>

  <dt>bylag </dt>
<dd><p>increment of the sequence of lag values.</p></dd>

  <dt>coefficients, vcov </dt>
<dd><p>coefficients and their variance-covariance matrix.</p></dd>

  <dt>matfit, matse </dt>
<dd><p>matrices of predictions and standard errors at the chosen combinations of predictor and lag values.</p></dd>

  <dt>matlow, mathigh </dt>
<dd><p>matrices of confidence intervals for <code>matfit</code>.</p></dd>

  <dt>allfit, allse </dt>
<dd><p>vectors of the overall cumulative predicted association and standard errors.</p></dd>

  <dt>alllow, allhigh </dt>
<dd><p>vectors of confidence intervals for <code>allfit</code>.</p></dd>

  <dt>cumfit, cumse </dt>
<dd><p>matrices of incremental cumulative predicted associations along lags and related standard errors at the chosen combinations of predictor and (integer) lag values. Computed if <code>cumul=TRUE</code>.</p></dd>

  <dt>cumlow, cumhigh </dt>
<dd><p>matrices of confidence intervals for <code>cumfit</code>. Computed if <code>cumul=TRUE</code>.</p></dd>

  <dt>matRRfit </dt>
<dd><p>matrix of exponentiated specific associations from <code>matfit</code>.</p></dd>

  <dt>matRRlow, matRRhigh </dt>
<dd><p>matrices of confidence intervals for <code>matRRfit</code>.</p></dd>

  <dt>allRRfit </dt>
<dd><p>vector of exponentiated overall cumulative associations from <code>allfit</code>.</p></dd>

  <dt>allRRlow, allRRhigh </dt>
<dd><p>vectors of confidence intervals for <code>allRRfit</code>.</p></dd>

  <dt>cumRRfit </dt>
<dd><p>matrix of exponentiated incremental cumulative associations from <code>cumfit</code>. Computed if <code>cumul=TRUE</code>.</p></dd>

  <dt>cumRRlow, cumRRhigh </dt>
<dd><p>matrix of confidence intervals for . Computed if <code>cumul=TRUE</code>.</p></dd>

<dt>ci.level </dt>
<dd><p>confidence level used for the computation of confidence intervals for <code>cumRRfit</code>.</p></dd>

  <dt>model.class </dt>
<dd><p>class of the model command used for estimation.</p></dd>

  <dt>model.link </dt>
<dd><p>a specification for the model link function.</p></dd>

</dl><p>The function <code>summary.crosspred</code> returns a summary of the list.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Gasparrini A. Distributed lag linear and non-linear models in R: the package dlnm. <em>Journal of Statistical Software</em>. 2011;<b>43</b>(8):1-20. [freely available <a href="http://www.ag-myresearch.com/2011_gasparrini_jss.html" class="external-link">here</a>].</p>
<p>Gasparrini A, Scheipl F, Armstrong B, Kenward MG. A penalized framework for distributed lag non-linear models. <em>Biometrics</em>. 2017;<b>73</b>(3):938-948. [freely available <a href="http://www.ag-myresearch.com/2017_gasparrini_biomet.html" class="external-link">here</a>]</p>
<p>Gasparrini A. Modeling exposure-lag-response associations with distributed lag non-linear models. <em>Statistics in Medicine</em>. 2014;<b>33</b>(5):881-899. [freely available <a href="http://www.ag-myresearch.com/2014_gasparrini_statmed.html" class="external-link">here</a>]</p>
<p>Gasparrini A., Armstrong, B.,Kenward M. G. Distributed lag non-linear models. <em>Statistics in Medicine</em>. 2010;<b>29</b>(21):2224-2234. [freely available <a href="http://www.ag-myresearch.com/2010_gasparrini_statmed.html" class="external-link">here</a>]</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Antonio Gasparrini &lt;<a href="mailto:antonio.gasparrini@lshtm.ac.uk">antonio.gasparrini@lshtm.ac.uk</a>&gt;</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>All the predictions are generated using a reference value, which if not directly specific by <code>cen</code> is given default values corresponding to (approximately) the mid-range point for continuous functions. Before version 2.2.0 of <span class="pkg">dlnm</span>, centering was produced in <code><a href="onebasis.html">onebasis</a></code> or <code><a href="crossbasis.html">crossbasis</a></code> (see the related help pages), and for backward compatibility this information is kept (with a warning) and used in <code>crosspred</code> unless <code>cen</code> is directly defined as an argument.</p>
<p>Exponentiated predictions are included if <code>model.link</code> (selected by the user or specified automatically by <code>model</code>) is equal to <code>"log"</code> or <code>"logit"</code>.</p>
    </div>
    <div id="warnings">
    <h2>Warnings</h2>
    <p>In case of collinear variables in the <code>basis</code> object, some of them are discarded and the related parameters not included in <code>model</code>. Then, <code>crosspred</code> will return an error. Check that the specification of the variables is meaningful through <code><a href="crossbasis.html">summary.crossbasis</a></code> or <code><a href="onebasis.html">summary.onebasis</a></code>.</p>
<p>The name of the object <code>basis</code>  will be used to extract the related estimated parameters from <code>model</code>. If more than one variable is transformed by cross-basis functions in the same model, <em>completely</em> different names must be specified (excluding also partial matching such as abbreviations).</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="onebasis.html">onebasis</a></code> to generate one-dimensional basis matrices. <code><a href="crossbasis.html">crossbasis</a></code> to generate cross-basis matrices. <code><a href="crossreduce.html">crossreduce</a></code> to reduce the fit to one dimension.
The method function <code><a href="plot.crosspred.html">plot</a></code> to plot several type of graphs.</p>
<p>See <code><a href="dlnm-package.html">dlnm-package</a></code> for an introduction to the package and for links to package vignettes providing more detailed information.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">### example of application in time series analysis - see vignette("dlnmTS")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># seasonal analysis: select summer months only</span></span></span>
<span class="r-in"><span><span class="va">chicagoNMMAPSseas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">chicagoNMMAPS</span>, <span class="va">month</span><span class="op">&gt;</span><span class="fl">5</span> <span class="op">&amp;</span> <span class="va">month</span><span class="op">&lt;</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create the crossbasis objects, including info on groups</span></span></span>
<span class="r-in"><span><span class="va">cb2.o3</span> <span class="op">&lt;-</span> <span class="fu"><a href="crossbasis.html">crossbasis</a></span><span class="op">(</span><span class="va">chicagoNMMAPSseas</span><span class="op">$</span><span class="va">o3</span>, lag<span class="op">=</span><span class="fl">5</span>,</span></span>
<span class="r-in"><span>  argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"thr"</span>,thr<span class="op">=</span><span class="fl">40.3</span><span class="op">)</span>, arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"integer"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  group<span class="op">=</span><span class="va">chicagoNMMAPSseas</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">cb2.temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="crossbasis.html">crossbasis</a></span><span class="op">(</span><span class="va">chicagoNMMAPSseas</span><span class="op">$</span><span class="va">temp</span>, lag<span class="op">=</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>  argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"thr"</span>,thr<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">25</span><span class="op">)</span><span class="op">)</span>, arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"strata"</span>,breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  group<span class="op">=</span><span class="va">chicagoNMMAPSseas</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cb2.o3</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CROSSBASIS FUNCTIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> observations: 1708 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> groups: 14 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range: 4.080899 to 65.80827 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag period: 0 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> total df:  6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR VAR:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: thr </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> thr.value: 40.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> side: h </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR LAG:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: integer </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> values: 0 1 2 3 4 5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cb2.temp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CROSSBASIS FUNCTIONS</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> observations: 1708 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> groups: 14 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> range: 6.666667 to 33.33333 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lag period: 0 10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> total df:  6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR VAR:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: thr </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> thr.value: 15 25 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> side: d </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> BASIS FOR LAG:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fun: strata </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> df: 3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> breaks: 2 6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ref: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> intercept: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">death</span> <span class="op">~</span>  <span class="va">cb2.o3</span> <span class="op">+</span> <span class="va">cb2.temp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">doy</span>, <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/splines/ns.html" class="external-link">ns</a></span><span class="op">(</span><span class="va">time</span>,<span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="va">dow</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">quasipoisson</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">chicagoNMMAPSseas</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># get the predictions for o3 at specific exposure values</span></span></span>
<span class="r-in"><span><span class="va">pred2.o3</span> <span class="op">&lt;-</span> <span class="fu">crosspred</span><span class="op">(</span><span class="va">cb2.o3</span>, <span class="va">model2</span>, at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">65</span>,<span class="fl">40.3</span>,<span class="fl">50.3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get figures for the overall cumulative association, with ci</span></span></span>
<span class="r-in"><span><span class="va">pred2.o3</span><span class="op">$</span><span class="va">allRRfit</span><span class="op">[</span><span class="st">"50.3"</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     50.3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1.047313 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">pred2.o3</span><span class="op">$</span><span class="va">allRRlow</span>, <span class="va">pred2.o3</span><span class="op">$</span><span class="va">allRRhigh</span><span class="op">)</span><span class="op">[</span><span class="st">"50.3"</span>,<span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.004775 1.091652</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot the estimated lag-response curve (with 80%CI)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred2.o3</span>, <span class="st">"slices"</span>, var<span class="op">=</span><span class="fl">50.3</span>, ci<span class="op">=</span><span class="st">"bars"</span>, type<span class="op">=</span><span class="st">"p"</span>, col<span class="op">=</span><span class="fl">2</span>, pch<span class="op">=</span><span class="fl">19</span>,</span></span>
<span class="r-in"><span>  ci.level<span class="op">=</span><span class="fl">0.80</span>, main<span class="op">=</span><span class="st">"Lag-response a 10-unit increase above threshold (80CI)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># plot the estimated overall cumulative exposure-response curve</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred2.o3</span>,<span class="st">"overall"</span>,xlab<span class="op">=</span><span class="st">"Ozone"</span>, ci<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="fl">3</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">1.3</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>  ci.arg<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col<span class="op">=</span><span class="fl">1</span>,lty<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Overall cumulative association for 5 lags"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># plot the estimated exposure-lag-response surface</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred2.o3</span>, xlab<span class="op">=</span><span class="st">"Ozone"</span>, main<span class="op">=</span><span class="st">"3D: default perspective"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pred2.o3</span>, xlab<span class="op">=</span><span class="st">"Ozone"</span>, main<span class="op">=</span><span class="st">"3D: different perspective"</span>, theta<span class="op">=</span><span class="fl">250</span>, phi<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of application beyond time series - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate the matrix of exposure histories from the weekly data</span></span></span>
<span class="r-in"><span><span class="va">Qdrug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">drug</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">7</span><span class="op">:</span><span class="fl">4</span>, each<span class="op">=</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Qdrug</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"lag"</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">27</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define the cross-basis</span></span></span>
<span class="r-in"><span><span class="va">cbdrug</span> <span class="op">&lt;-</span> <span class="fu"><a href="crossbasis.html">crossbasis</a></span><span class="op">(</span><span class="va">Qdrug</span>, lag<span class="op">=</span><span class="fl">27</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"lin"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"ns"</span>,knots<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>,<span class="fl">18</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model, predict, and show estimates for specific values</span></span></span>
<span class="r-in"><span><span class="va">mdrug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">out</span><span class="op">~</span><span class="va">cbdrug</span><span class="op">+</span><span class="va">sex</span>, <span class="va">drug</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pdrug</span> <span class="op">&lt;-</span> <span class="fu">crosspred</span><span class="op">(</span><span class="va">cbdrug</span>, <span class="va">mdrug</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pdrug</span>,<span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">allfit</span>,<span class="va">alllow</span>,<span class="va">allhigh</span><span class="op">)</span><span class="op">[</span><span class="st">"50"</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   allfit   alllow  allhigh </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30.29584 20.12871 40.46298 </span>
<span class="r-in"><span><span class="va">pdrug</span><span class="op">$</span><span class="va">matfit</span><span class="op">[</span><span class="st">"20"</span>,<span class="st">"lag3"</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.118139</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># bi-dimensional exposure-lag-response association</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdrug</span>, zlab<span class="op">=</span><span class="st">"Effect"</span>, xlab<span class="op">=</span><span class="st">"Dose"</span>, ylab<span class="op">=</span><span class="st">"Lag (days)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdrug</span>, var<span class="op">=</span><span class="fl">60</span>, ylab<span class="op">=</span><span class="st">"Effect at dose 60"</span>, xlab<span class="op">=</span><span class="st">"Lag (days)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdrug</span>, lag<span class="op">=</span><span class="fl">10</span>, ylab<span class="op">=</span><span class="st">"Effect at lag 10"</span>, xlab<span class="op">=</span><span class="st">"Dose"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of extended predictions - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># dose 20 for 10 days</span></span></span>
<span class="r-in"><span><span class="va">histdrug</span> <span class="op">&lt;-</span> <span class="fu"><a href="exphist.html">exphist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">10</span><span class="op">)</span>, time<span class="op">=</span><span class="fl">10</span>, lag<span class="op">=</span><span class="fl">27</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pdrug4</span> <span class="op">&lt;-</span> <span class="fu">crosspred</span><span class="op">(</span><span class="va">cbdrug</span>, <span class="va">mdrug</span>, at<span class="op">=</span><span class="va">histdrug</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pdrug4</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">allfit</span>,<span class="va">alllow</span>,<span class="va">allhigh</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        10        10        10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9.633688  7.829238 11.438138 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define exposure profile with weekly exposures to 10, 50, 0 and 20</span></span></span>
<span class="r-in"><span><span class="va">expdrug</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">50</span>,<span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define the exposure histories for all the time points</span></span></span>
<span class="r-in"><span><span class="va">dynhist</span> <span class="op">&lt;-</span> <span class="fu"><a href="exphist.html">exphist</a></span><span class="op">(</span><span class="va">expdrug</span>, lag<span class="op">=</span><span class="fl">27</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># predict the effects</span></span></span>
<span class="r-in"><span><span class="va">pdyndrug</span> <span class="op">&lt;-</span> <span class="fu">crosspred</span><span class="op">(</span><span class="va">cbdrug</span>, <span class="va">mdrug</span>, at<span class="op">=</span><span class="va">dynhist</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot of the evolution of the effects along time given the doses</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdyndrug</span>,<span class="st">"overall"</span>, ylab<span class="op">=</span><span class="st">"Effect"</span>, xlab<span class="op">=</span><span class="st">"Time (days)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>,<span class="fl">27</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of user-defined functions - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define the decay function</span></span></span>
<span class="r-in"><span><span class="va">fdecay</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">scale</span><span class="op">=</span><span class="fl">5</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">/</span><span class="va">scale</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">basis</span><span class="op">)</span><span class="op">$</span><span class="va">scale</span> <span class="op">&lt;-</span> <span class="va">scale</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">basis</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define the cross-basis</span></span></span>
<span class="r-in"><span><span class="va">cbdrug2</span> <span class="op">&lt;-</span> <span class="fu"><a href="crossbasis.html">crossbasis</a></span><span class="op">(</span><span class="va">Qdrug</span>, lag<span class="op">=</span><span class="fl">27</span>, argvar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"lin"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  arglag<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fun<span class="op">=</span><span class="st">"fdecay"</span>,scale<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in get(fun, mode = "function", envir = envir):</span> object 'fdecay' of mode 'function' was not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cbdrug2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'cbdrug2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run the model and predict</span></span></span>
<span class="r-in"><span><span class="va">mdrug2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">out</span><span class="op">~</span><span class="va">cbdrug2</span><span class="op">+</span><span class="va">sex</span>, <span class="va">drug</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(predvars, data, env):</span> object 'cbdrug2' not found</span>
<span class="r-in"><span><span class="va">pdrug2</span> <span class="op">&lt;-</span> <span class="fu">crosspred</span><span class="op">(</span><span class="va">cbdrug2</span>, <span class="va">mdrug2</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">20</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'cbdrug2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot and compare with previous fit</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdrug2</span>, zlab<span class="op">=</span><span class="st">"Effect"</span>, xlab<span class="op">=</span><span class="st">"Dose"</span>, ylab<span class="op">=</span><span class="st">"Lag (days)"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pdrug2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdrug2</span>, var<span class="op">=</span><span class="fl">60</span>, ylab<span class="op">=</span><span class="st">"Effect at dose 60"</span>, xlab<span class="op">=</span><span class="st">"Lag (days)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pdrug2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pdrug</span>, var<span class="op">=</span><span class="fl">60</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pdrug2</span>, lag<span class="op">=</span><span class="fl">10</span>, ylab<span class="op">=</span><span class="st">"Effect at lag 10"</span>, xlab<span class="op">=</span><span class="st">"Dose"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'pdrug2' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pdrug</span>, lag<span class="op">=</span><span class="fl">10</span>, lty<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of general use for regression models - see vignette("dlnmExtended")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># replicate example illustrated in help(ns)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">oneheight</span> <span class="op">&lt;-</span> <span class="fu"><a href="onebasis.html">onebasis</a></span><span class="op">(</span><span class="va">women</span><span class="op">$</span><span class="va">height</span>, <span class="st">"ns"</span>, df<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mwomen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">oneheight</span>, data<span class="op">=</span><span class="va">women</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pwomen</span> <span class="op">&lt;-</span> <span class="fu">crosspred</span><span class="op">(</span><span class="va">oneheight</span>, <span class="va">mwomen</span>, cen<span class="op">=</span><span class="fl">65</span>, at<span class="op">=</span><span class="fl">58</span><span class="op">:</span><span class="fl">72</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pwomen</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">allfit</span>, <span class="va">alllow</span>, <span class="va">allhigh</span><span class="op">)</span><span class="op">[</span><span class="st">"70"</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   allfit   alllow  allhigh </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18.92287 18.46545 19.38030 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pwomen</span>, ci<span class="op">=</span><span class="st">"l"</span>, ylab<span class="op">=</span><span class="st">"Weight (lb) difference"</span>, xlab<span class="op">=</span><span class="st">"Height (in)"</span>, col<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># replicate example illustrated in help(gam)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: nlme</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> This is mgcv 1.9-3. For overview type 'help("mgcv-package")'.</span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html" class="external-link">gamSim</a></span><span class="op">(</span><span class="fl">1</span>,n<span class="op">=</span><span class="fl">200</span>,dist<span class="op">=</span><span class="st">"poisson"</span>,scale<span class="op">=</span><span class="fl">.1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Gu &amp; Wahba 4 term additive model</span>
<span class="r-in"><span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x0</span>,bs<span class="op">=</span><span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x1</span>,bs<span class="op">=</span><span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x2</span>,bs<span class="op">=</span><span class="st">"cr"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x3</span>,bs<span class="op">=</span><span class="st">"cr"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  family<span class="op">=</span><span class="va">poisson</span>, data<span class="op">=</span><span class="va">dat</span>, method<span class="op">=</span><span class="st">"REML"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b2</span>, select<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">pgam</span> <span class="op">&lt;-</span> <span class="fu">crosspred</span><span class="op">(</span><span class="st">"x2"</span>, <span class="va">b2</span>, cen<span class="op">=</span><span class="fl">0</span>, at<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">100</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pgam</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">allRRfit</span>, <span class="va">allRRlow</span>, <span class="va">allRRhigh</span><span class="op">)</span><span class="op">[</span><span class="st">"0.7"</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  allRRfit  allRRlow allRRhigh </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2.959202  1.566657  5.589529 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pgam</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"RR"</span>, xlab<span class="op">=</span><span class="st">"x2"</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="crosspred-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### example of penalized models - see vignette("dlnmPenalized")</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># to be added soon</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Antonio Gasparrini, Ben Armstrong.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

