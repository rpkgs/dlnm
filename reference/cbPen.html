<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Generate Penalty Matrices for a DLNM — cbPen • dlnm</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Generate Penalty Matrices for a DLNM — cbPen"><meta property="og:description" content="This function generates penalty matrices for the two dimensions of predictor and lags, given the functions selected to model the relationship in each space. It can also be used for generating the single penalty matrix for the predictor space of a uni-dimensional basis not accouning for lags."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dlnm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.4.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/basics.html">basics</a>
    </li>
    <li>
      <a href="../articles/dlmnTS.html">dlmnTS</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/gasparrini/dlnm/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate Penalty Matrices for a DLNM</h1>

    <div class="hidden name"><code>cbPen.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function generates penalty matrices for the two dimensions of predictor and lags, given the functions selected to model the relationship in each space. It can also be used for generating the single penalty matrix for the predictor space of a uni-dimensional basis not accouning for lags.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">cbPen</span><span class="op">(</span><span class="va">cb</span>, sp<span class="op">=</span><span class="op">-</span><span class="fl">1</span>, addSlag<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <p></p>
<dl><dt id="arg-cb-">cb <a class="anchor" aria-label="anchor" href="#arg-cb-"></a></dt>
<dd><p>an object of class <code>"crossbasis"</code> or <code>"onebasis"</code>.</p></dd>

  <dt id="arg-sp-">sp <a class="anchor" aria-label="anchor" href="#arg-sp-"></a></dt>
<dd><p>supplied smoothing parameters. See Details below.</p></dd>

  <dt id="arg-addslag-">addSlag <a class="anchor" aria-label="anchor" href="#arg-addslag-"></a></dt>
<dd><p>matrix or vector (or list of matrices and/or vectors) defining additional penalties on the lag structure. See Details below.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function is used to perform penalized regression models using the <em>external</em> method. This involves generating the transformation using <code><a href="crossbasis.html">crossbasis</a></code> or <code><a href="onebasis.html">onebasis</a></code> with functions for penalized splines (either <code><a href="ps.html">ps</a></code> or <code><a href="cr.html">cr</a></code>). The function <code>cbPen</code> is then called to generate a list of the related penalty matrices. The model is performed by penalizing so-called parametric terms in the <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code> function of <span class="pkg">mgcv</span>, by including the basis or cross-basis matrix in the regression formula and the list of penalty matrices in its <code>paraPen</code> argument.</p>
<p>When <code>cb</code> is a cross-basis object, the penalty matrices for the two spaces of predictor and lags are rescaled and expanded accordingly to its tensor product-type structure. A penalty matrix is not defined when using a function different than <code><a href="ps.html">ps</a></code> or <code><a href="cr.html">cr</a></code>, thus keeping one of the two dimensions unpenalized.</p>
<p>Additional penalties on the lag dimension can be added through the argument <code>addSlag</code>, either as a single matrix or a list of matrices. If provided as a vector, this is taken as the diagonal of the penalty matrix and expanded accordingly. These objects must have appropriate dimensions in accordance with the basis matrix for the lag space.</p>
<p>All the penalty matrices are also appropriately rescaled to improve the estimation process.</p>
<p>The vector <code>sp</code> must have the same length as the number of penalties, including additional penalties on the lags, and it is replicated accordingly if of length 1. Positive or zero elements are taken as fixed smoothing parameters. Negative elements signal that these parameters need to be estimated.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>A list including penalty matrices plus two vectors <code>rank</code> and <code>sp</code> defining their rank and the smoothing parameters. This list is consistent with the argument <code>paraPen</code> in the regression function <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></code> function of <span class="pkg">mgcv</span>.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Gasparrini A, Scheipl F, Armstrong B, Kenward MG. A penalized framework for distributed lag non-linear models. <em>Biometrics</em>. 2017;<b>73</b>(3):938-948. [freely available <a href="http://www.ag-myresearch.com/2017_gasparrini_biomet.html" class="external-link">here</a>]</p>

<p>Wood S. N. Generalized Additive Models: An Introduction with R. Chapman and Hall/CRC Press, 2006.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Antonio Gasparrini &lt;<a href="mailto:antonio.gasparrini@lshtm.ac.uk">antonio.gasparrini@lshtm.ac.uk</a>&gt;</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="ps.html">ps</a></code> and <code><a href="cr.html">cr</a></code> for penalized spline functions. The <code><a href="smooth.construct.cb.smooth.spec.html">cb smooth constructor</a></code> for cross-basis penalized spline smooths.</p>
<p>See <code><a href="dlnm-package.html">dlnm-package</a></code> for an introduction to the package and for links to package vignettes providing more detailed information, in particular the vignette <strong>dlnmPenalized</strong>.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># to be added soon</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Antonio Gasparrini, Ben Armstrong.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

